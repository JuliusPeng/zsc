<html>

<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script type="text/javascript" src="./web3.js/dist/web3.js"></script>
<script type="text/javascript" src="./web3js.js"></script>
<script type="text/javascript" src="./userFunctions.js"></script>
<script type="text/javascript" src="./basicFunctions.js"></script>
<script type="text/javascript" src="./zsc_element.js"></script>
<script type="text/javascript" src="./zsc_user.js"></script>
<script type="text/javascript" src="./zsc_wallet.js"></script>
<script type="text/javascript" src="./zsc_html.js"></script>
<script type="text/javascript" src="./zsc_transactions.js"></script>
<script type="text/javascript">

    var web3 = setupWeb3js(false);

    var zscHtml = new ZSCHtml();
    var zscUser;
    var zscElement;
    var zscWalletGM;
    var zscTransGM;

    /*tag:
    logon, wallet, profile, templates, agreements
    */
    function htmlLoadLogin() {
        document.getElementById("PageHeader").innerHTML = "";  
        document.getElementById("PageBody").innerHTML = "";  
        zscHtml.setHtmlCotentIds( "PageBody", "PageHeader");
        zscHtml.loadPageBody("login", "checkUser", "null", "null");
    }

    function checkUser(adrId, userId, passId){
        var admAdr = document.getElementById(adrId).value; 
        var user = document.getElementById(userId).value; 
        var pass = document.getElementById(passId).value; 

        zscUser = new ZSCUser(admAdr);
        zscUser.tryLogin(user, pass, function(ret) {
            if(ret) {
                var fullAbi = zscUser.getControlApisFullAbi();
                var controlApisAdvAdr = zscUser.getControlApisAdr();
                zscElement  = new ZSCElement(fullAbi, controlApisAdvAdr);
                zscWalletGM = new ZSCWallet(zscUser.getUserName, fullAbi, controlApisAdvAdr);
                zscTransGM  = new ZSCTransactions(zscUser.getUserName, fullAbi, controlApisAdvAdr)
                loadHtmlPageBody("welecome");
            } else {
                alert("User name or password wrong!!");
            }
        });
    }

    function applyForUser(type, hashLogId) {
        zscUser.applyForUser(type, hashLogId, function() {
            loadHtmlPageBody("applied");
        }); 
    }

    function reFresh() {
        loadHtmlPageBody("apply");
    }

    function transferValue(destAddressId, amountId, logId) {
        var adr = document.getElementById(destAddressId).value; 
        var amount = document.getElementById(amountId).value; 

        ZSCWalletGM.transferValue(destAddress, amount, logId);

        loadHtmlPageBody("wallet");
    }

    function showErc20Tokens(destAddressId, amountId, logId) {
        var adr = document.getElementById(destAddressId).value; 
        var amount = document.getElementById(amountId).value; 

        zscElement.transferEth(destAddress, amount, logId);
    }

    function submitProfileChanges(logID) {
        zscElement.setElementParameter(logID, zscUser.getUserNameHr());
    }

    function showTransactions(tokenSymbol, elementId) {
        zscTransGM.setTokenSymbol(tokenSymbol);
        loadPageBody("transaction");
    }

</script>
</head>
<body>
    <div class="col-lg-12">
        <i>Web-client for testing ZSC system</i>
        <div class="col-lg-6" id="PageHeader"></div>
        <div class="col-lg-6" id="PageBody"></div>
    </div>
<script type="text/javascript">
    htmlLoadLogin();

    function loadHtmlPageBody(tag) {
        document.getElementById("PageBody").innerHTML = "";  
        zscHtml.loadPageHeader("loadHtmlPageBody");

        if (tag == "welecome") {
            zscHtml.loadPageBody("welecome", "loadHtmlPageBody","null", "null");
        } else if (tag == "apply") {
            zscUser.getUserStatusFromAdm(function(status) {
                if (status == 0) {
                    //Should not happen 
                } else if (ret == "added") {
                    zscHtml.loadButtonForEnablingElement("applyForUser");
                } else if (ret == "applied") {
                    loadHtmlPageBody("applied");
                } else if (ret == "approved") {
                    loadHtmlPageBody("approved");
                }
            });  
        } else if (tag == "applied") {
            zscHtml.loadWaitingApproval("reFresh", zscUser.getUserType());
        } else {
            if (tag == "wallet") {
                zscWalletGM.loadTokenWallets(function() {
                    zscHtml.loadPageBody(tag, "transferEthTo", "showTransactions", ZSCWalletGM);
                });
            } else if (tag == "profile") {
                zscElement.loadParameterNamesAndvalues(function() {
                    zscHtml.loadPageBody(tag, "submitProfileChanges", "null", zscElement);
                });
            } else if (tag == "transaction") {
                zscTransGM.loadTransactions(function() {
                    zscHtml.loadPageBody(tag, "null", "null", zscTransGM);
                });
            } else if (tag == "templates") {
                uF_loadBindedEntities(tag, function() {
                }
            }
        }
    }
</script>
</body>
</html>
